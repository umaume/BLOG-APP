# 画面遷移図

## 概要
ブログアプリケーションの画面遷移図を以下に示します。ユーザー認証機能、記事投稿・閲覧機能、コメント機能、タグ機能、いいね機能を含む包括的な設計です。

## Figma
Figma：https://www.figma.com/design/43wp3igbXrYHRJcP70Htnz/%E7%94%BB%E9%9D%A2%E9%81%B7%E7%A7%BB%E5%9B%B3?node-id=0-1&p=f&t=xwvASpVKOHjEQbN8-0

## 機能一覧

### MVPリリース時の機能
- [ ] ユーザー認証機能（サインアップ・ログイン・ログアウト）
- [ ] 記事の基本CRUD機能（作成・読み取り・更新・削除）
- [ ] 記事一覧・詳細表示機能
- [ ] ユーザープロフィール機能
- [ ] 基本的なレスポンシブデザイン
- [ ] 画像アップロード機能（Active Storage）
- [ ] カテゴリー・タグ機能
- [ ] コメント機能
- [ ] いいね機能
- [ ] DM（ダイレクトメッセージ）機能
- [ ] ユーザーフォロー・フォロワー機能

## 未ログインでも閲覧または利用できるページ
### 未ログインでも閲覧または利用できる画面遷移になっているか？
- [x] 記事閲覧機能（未ログインでも閲覧可能）
- [x] コメント閲覧機能（未ログインでも閲覧可能）
- [ ] 記事投稿機能（画像投稿含む） ※ログイン必須として設計

### 制限事項
- 記事投稿、編集、削除：ログイン必須
- コメント投稿、編集、削除：ログイン必須
- フォロー・フォロワー機能：ログイン必須
- DM機能：ログイン必須（相互フォロー時のみ）
- ブックマーク機能：ログイン必須
- タイムライン機能：ログイン必須
- リアルタイム通知：ログイン必須

## メールアドレス・パスワード変更確認項目

### 直接変更できるものではなく、一旦メールなどを介して専用のページで変更する画面遷移になっているか？
- [x] メールアドレス：確認メール → メール内リンク → 確認ページ → パスワード認証
- [x] パスワード：現在パスワード確認 → 確認メール → メール内リンク → 確認ページ → 変更完了

### セキュリティ対策
1. **メールアドレス変更**
   - 新しいメールアドレスに確認メール送信
   - メール内の専用リンクからのみアクセス可能
   - 現在のパスワードでの本人確認必須

2. **パスワード変更**
   - 現在のパスワード入力必須
   - 確認メール送信で二重認証
   - 変更後は強制再ログイン

## ページ別アクセス制御

| ページ | 未ログイン | ログイン済み | 作成者のみ | 相互フォロー時 |
|--------|------------|--------------|------------|----------------|
| トップページ（記事一覧） | ✅ | ✅ | - | - |
| 記事詳細 | ✅ | ✅ | - | - |
| 記事作成 | ❌ | ✅ | - | - |
| 記事編集 | ❌ | ❌ | ✅ | - |
| 記事削除 | ❌ | ❌ | ✅ | - |
| コメント閲覧 | ✅ | ✅ | - | - |
| コメント投稿 | ❌ | ✅ | - | - |
| コメント編集 | ❌ | ❌ | ✅ | - |
| コメント削除 | ❌ | ❌ | ✅ | - |
| タグ作成 | ❌ | ✅ | - | - |
| いいね機能 | ✅ | ✅ | - | - |
| ブックマーク機能 | ❌ | ✅ | - | - |
| フォロー機能 | ❌ | ✅ | - | - |
| タイムライン | ❌ | ✅ | - | - |
| DM機能 | ❌ | ❌ | - | ✅ |
| ユーザー登録 | ✅ | ❌ | - | - |
| ログイン | ✅ | ❌ | - | - |
| マイページ | ❌ | ✅ | - | - |
| プロフィール閲覧 | ✅ | ✅ | - | - |
| 全文検索 | ✅ | ✅ | - | - |

## 技術的考慮事項

### 認証・認可
- Devise gem を使用したユーザー認証
- Strong Parameters による入力値検証
- フォロー関係に基づくアクセス制御

### セキュリティ
- CSRF対策（Rails標準）
- XSS対策（Rails標準のHTMLエスケープ）
- SQLインジェクション対策（ActiveRecord ORM）
- パスワードのハッシュ化（bcrypt）
- DM暗号化（message_encryptor）

### リアルタイム機能
- Action Cable による WebSocket 通信
- Redis を使用した Pub/Sub メッセージング
- リアルタイム通知配信
- タイムライン自動更新

### 通知機能
- Web Push API によるブラウザ通知
- Service Worker によるバックグラウンド通知
- アプリ内通知センター

### 画像・メディア処理
- Active Storage による画像アップロード
- Cloudinary による画像配信・最適化
- LinkThumbnailer による URL プレビュー生成

### パフォーマンス・スケーラビリティ
- ページネーション実装（Kaminari）
- N+1クエリ対策
- PostgreSQL Full Text Search
- Solid Cache による高速キャッシュ
- PWA対応によるオフライン機能

### UX/UI
- Tailwind CSS によるレスポンシブデザイン
- Stimulus による軽量JavaScript
- Turbo による高速ページ遷移
- フラッシュメッセージによるユーザーフィードバック
- 確認ダイアログによる誤操作防止
