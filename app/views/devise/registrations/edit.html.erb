<% add_breadcrumb "ホーム", root_path %>
<% add_breadcrumb "アカウント設定" %>

<div class="max-w-2xl mx-auto">
  <div class="bg-white rounded-lg shadow-md p-6 sm:p-8">
    <h2 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-6">アカウント設定</h2>

    <%= form_for(resource, as: resource_name, url: registration_path(resource_name), html: { method: :put, class: "space-y-6" }) do |f| %>
      <%= render "devise/shared/error_messages", resource: resource %>

      <!-- Email Field -->
      <div>
        <%= f.label :email, "メールアドレス", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.email_field :email, 
            autofocus: true, 
            autocomplete: "email",
            class: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors" %>
      </div>

      <% if devise_mapping.confirmable? && resource.pending_reconfirmation? %>
        <div class="bg-yellow-50 border border-yellow-200 rounded-md p-4">
          <div class="flex">
            <svg class="w-5 h-5 text-yellow-400 mr-2 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
            </svg>
            <p class="text-sm text-yellow-800">
              確認待ち: <%= resource.unconfirmed_email %>
            </p>
          </div>
        </div>
      <% end %>

      <!-- Password Fields -->
      <div class="border-t pt-6">
        <h3 class="text-lg font-medium text-gray-900 mb-4">パスワード変更</h3>
        
        <div class="space-y-4">
          <div>
            <%= f.label :password, "新しいパスワード", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= f.password_field :password, 
                autocomplete: "new-password",
                class: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors" %>
            <p class="text-xs text-gray-500 mt-1">
              パスワードを変更しない場合は空白のままにしてください
            </p>
            <% if @minimum_password_length %>
              <p class="text-xs text-gray-500 mt-1">
                <%= @minimum_password_length %>文字以上で設定してください
              </p>
            <% end %>
          </div>

          <div>
            <%= f.label :password_confirmation, "新しいパスワード（確認）", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= f.password_field :password_confirmation, 
                autocomplete: "new-password",
                class: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors" %>
          </div>

          <div>
            <%= f.label :current_password, "現在のパスワード", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= f.password_field :current_password, 
                autocomplete: "current-password",
                class: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors" %>
            <p class="text-xs text-gray-500 mt-1">
              変更を保存するために現在のパスワードが必要です
            </p>
          </div>
        </div>
      </div>

      <!-- Submit Button -->
      <div class="flex flex-col sm:flex-row gap-4 pt-6 border-t">
        <%= f.submit "設定を更新", 
            class: "w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-md transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" %>
        <%= link_to "キャンセル", :back, 
            class: "w-full sm:w-auto bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-6 rounded-md transition-colors duration-200 text-center" %>
      </div>
    <% end %>
  </div>

  <!-- Account Deletion Section -->
  <div class="bg-white rounded-lg shadow-md p-6 sm:p-8 mt-6 border-l-4 border-red-500">
    <h3 class="text-lg font-semibold text-red-800 mb-4 flex items-center">
      <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.464 0L4.34 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
      </svg>
      アカウント削除
    </h3>
    
    <div class="bg-red-50 rounded-md p-4 mb-4">
      <p class="text-sm text-red-700">
        <strong>注意:</strong> この操作は取り消すことができません。アカウントを削除すると、すべての投稿、コメント、フォロー関係が完全に削除されます。
      </p>
    </div>
    
    <div class="flex flex-col sm:flex-row gap-4">
      <%= button_to "アカウントを削除する", 
          registration_path(resource_name), 
          method: :delete,
          data: { 
            confirm: "本当にアカウントを削除しますか？この操作は取り消すことができません。",
            turbo_confirm: "本当にアカウントを削除しますか？この操作は取り消すことができません。" 
          },
          class: "w-full sm:w-auto bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-6 rounded-md transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2" %>
    </div>
  </div>
</div>
